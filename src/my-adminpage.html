<!-- imports -->

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="facivon.ico">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-label/iron-label.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">	
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">	
<link rel="import" href="../bower_components/paper-button/paper-button.html">	
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">	
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">		
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">	
<link rel="import" href="../bower_components/paper-item/paper-item.html">	
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">	


<dom-module id="my-adminpage">
	<template>
		<style>
		body{
			background: #003399;
		}
		:host {
			display: block;
			padding: 16px;
			background: #003399;
		}
		.nav {
			width: 100%;
			height: 60px;
			justify-content: flex-start;
			margin: 4px 4px;
			background-color: #66ccff;
			display: flex;
		}
		.header {
			display: flex;
			flex-direction: column;
			justify-content: flex-start;
		}
		.logo {
			width: 80px;
			height: 70px;
			
		}
		.inputSearch {
			width: 50%;
			height: 50px;
			box-sizing: border-box;
			border: 2px solid #ccc;
			border-radius: 10px;
			font-size: 15px;
			background-color: white;
			background-image: url('images/search.png');
			background-size: 25px 25px;
			background-position: 10px 11px; 
			background-repeat: no-repeat;
			padding: 12px 20px 12px 40px;
			margin-top: 4px;
		}
		
		.component {
			width: 45%;
			height: 50px;
			margin-top: 4px;
			display: flex;
			justify-content: flex-end;
		}
		.component paper-icon-button:hover {
			background-color: #93d7f9;
		}
		.material-icons{
			font-size: 45px;
			margin-top: 4px;
			color: black;
		}
		.profile {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			margin-top: 20px;
		}
		#pic {
		max-width: 150px;
		min-width: 150px;
		}
		.details{
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}
		.name {
			display: flex;
		}
		.uname {
			display: flex;
			margin-top: -15px;
		}
		.style1{
			border-top: 2px solid #000000;
		}
		.content button, .card-details button{
			background-color: #3f51b5;
			border: none;
			color: white;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			font-weight: bold;
			margin: 4px 2px;
			cursor: pointer;
		}
		.follow, .chat, .block, paper-button{
			float: right;
		}
		.content button:hover{
			background-color: #6a7eed;
		}
		.card{
			display: flex;
			background-color: #66ccff;
		}
		#user {
			width: 70px;
			height: 70px;
			margin-top: 10px;
			margin-left: 10px;
		}
		.nav-tabs{
			background-color: #cbfffa;
		}
		.flex-container {
			display: -webkit-flex;
			display: flex;
			-webkit-justify-content: center;
			justify-content: center;
			width: 100%;
			height: 100%;
		}
		.flex-item1 {
			width: 25%;
			height: 100%;
			margin: 10px;
			background-color: pink <!--#cbfffa; -->
			box-shadow: 0px 8px 10px 0 rgba(0,0,0,0.2);
			margin-left: 7px;
		}
		.flex-item2 {
			background-color: pink <!--#cbfffa; -->
			width: 140%;
			height: 100%;
			margin: 10px;
			
		}
		paper-tabs {
			font-family: 'Roboto', 'Noto', sans-serif;
			-webkit-font-smoothing: antialiased;
			width: 100%;
			text-transform: uppercase;
			margin-bottom: 1px;
		}
		paper-button{
			background-color: #3f51b5;
			border: none;
			color: white;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			font-weight: bold;
			margin: 4px 2px;
			cursor: pointer;
			height: 25%;
		}
		#search {
			width: 70%;
			border: 2px solid #ccc;
			background-color: white;
			float: left;
			border-radius: 10px;
		}
		* {
			box-sizing: border-box;
		}
		.left {
			padding:5px;
			float:left;
			width:30%;
		}
		.main {
			padding:5px;
			float:left;
			width:70%;
		}
		/*Use a media query to add a break point at 800px:*/
		@media (max-width:800px) {
			.left, .main{
				width:100%;
			}
		}
		.card{
			background-color: #cbfffa;
			margin: 15px;
			width: 100%;
			box-shadow: 4px 8px 10px 0 rgba(0,0,0,0.2);
			display: flex;
			padding: 10px 10px;
		}
		.post-card {
			letter-spacing: 0px;
			word-spacing: 0.5px;
			background-color: white;
			font-size: 14px;
			padding: 10px;
			margin-bottom: 10px;
			margin-top: 0;
			margin-left: 10px;
			box-shadow: 4px 8px 10px 0 rgba(0,0,0,0.2);
			transition: 0.3s;
			width: 80%;
		}
		.cat{
			margin: 10px 10px;
			color: black;
		}
                
		</style>
		<!-- elements -->
		<div class=""all">
		<div class = "header">
			<div class = "nav">
				<a href = "#"><img class = "logo" src ="images/logo.png" title = "let's uzap" /></a>
				<paper-input label = "Search..." id = "search" ></paper-input>
				<div class = "component">
					<a name="dashboard" href="/dashboard"><paper-icon-button src="images/home.png" title="Home"></paper-icon-button></a>
					<paper-icon-button src="images/notification.png" title="Notification"></paper-icon-button></a>
					<a name="user-profile" href="/user-profile"><paper-icon-button src="images/_tab.png" title="Profile"></paper-icon-button></a>
					<paper-icon-button src="images/logout.png" title="Logout" on-click="logout"></paper-icon-button>
				</div>
			</div>
		</div>
		
		<div class="left">
			<div class = "card">
				<div class="cat"> Number of Users </div>
				<div class = "post-card">
					<div id="numberOfUsers"></div>
				</div>
			</div>
			<div class = "card">
				<div class="cat"> Number of Posts  </div>
				<div class = "post-card">
					<div id="numberOfPosts"> </div>
				</div>
				<!--<paper-item name="{{numberOfUsers}}" value="{{numberOfUsers}}"></paper-item>-->
			</div>
		</div>
		<div class="main">
			<div class = "card">
				Reported Users
				
			</div>
			<div class = "card">
				Blocked Users
				
			</div>
		</div>
		<div id="results"> </div>
		<br>
		
		<br>
		<iron-ajax
			id = "dbGetNumberOfUsers"
			url = "http://127.0.0.1:8080/db/users"
			method = "GET"
			handle-as = "json"
			content-type = "application/json"
			on-response = "getUsers"
			debounce-duration="300">
		</iron-ajax>
		
		<iron-ajax
			id = "dbGetNumberOfPosts"
			url = "http://127.0.0.1:8080/db/posts"
			method = "GET"
			handle-as = "json"
			content-type = "application/json"
			on-response = "getPosts"
			debounce-duration="300">
		</iron-ajax>
		
		<iron-ajax
			id = "dbGetReportedAccounts"
			url = "http://127.0.0.1:8080/db/users?filter={%27status%27:%20%27REPORTED%27}"
			method = "GET"
			handle-as = "json"
			content-type = "application/json"
			on-response = "getReportedAccounts"
			debounce-duration="300">
		</iron-ajax>
		
		<iron-ajax
			id = "dbGetBlockedAccounts"
			url = "http://127.0.0.1:8080/db/users?gilter={'status': 'BLOCKED'}"
			method = "GET"
			handle-as = "json"
			content-type = "application/json"
			on-response = "getBlockedAccounts"
			debounce-duration="300">
		</iron-ajax>
	
		<footer>
			<center><br><br>
				<div id="footer_text"> <font color="white">
					This product is developed by G6.<br>
					G6 2017 </font>
				</div>
			</center>
		</footer>
        </div>
	</template>
	

	<script>
	class MyAdminpage extends Polymer.Element {
		static get is() { return 'my-adminpage'; }
		
		static get properties() {
			return {
				username: {type:String},
				numberOfPosts: {type: Number},		//returns how many posts are there all in all
				numberOfUsers: {type: Number}
			}
		}
	  
		ready()
		{
			super.ready();
			//this.username = localStorage.getItem("username");
			this.$.dbGetNumberOfUsers.generateRequest();
			this.$.dbGetNumberOfPosts.generateRequest();
			this.$.dbGetBlockedAccounts.generateRequest();
			this.$.dbGetReportedAccounts.generateRequest();
		}
		
		getUsers(e){
			const resp = e.detail.response;
			var response = JSON.stringify(resp, null, ' ');
			//this.$.results.innerHTML = response + "\n";
			
			var temp = response; // copy the result of the query
			var start = temp.search("returned")+11;
			var temp = temp.substr(start);
			var end = temp.search("}")-1;
			var numTrend = temp.slice(0, end);
			this.numberOfUsers = numTrend;
			this.$.numberOfUsers.innerHTML = numTrend;
		}
		getPosts(e){
			const resp = e.detail.response;
			var response = JSON.stringify(resp, null, ' ');
			//this.$.results.innerHTML = response + "\n";
			
			var temp = response; // copy the result of the query
			var start = temp.search("returned")+11;
			var temp = temp.substr(start);
			var end = temp.search("}")-1;
			var numTrend = temp.slice(0, end);
			this.$.numberOfPosts.innerHTML = numTrend;
		}
		getReportedAccounts(e){
			const resp = e.detail.response;
			var response = JSON.stringify(resp, null, ' ');
			//this.$.results.innerHTML = response + "\n";
			
			var temp = response; // copy the result of the query
			var start = temp.search('"},"username":')+14;
			var temp = temp.substr(start);
			var end = temp.search('"},{"_id":{"$oid":')-20;
			var numTrend = temp.slice(0, end);
			alert(numTrend);
			//this.$.numberOfPosts.innerHTML = numTrend;
		}
		getBlockedAccounts(e){
			const resp = e.detail.response;
			var response = JSON.stringify(resp, null, ' ');
			//this.$.results.innerHTML = response + "\n";
			
			var temp = response; // copy the result of the query
			var start = temp.search("returned")+11;
			var temp = temp.substr(start);
			var end = temp.search("}")-1;
			var numTrend = temp.slice(0, end);
			//this.$.numberOfPosts.innerHTML = numTrend;
		}
    }

    window.customElements.define(MyAdminpage.is, MyAdminpage);
	</script>
	
	<script>
	/*
	Polymer({
		is: 'my-adminpage'
	});
	*/
	</script>
</dom-module>

